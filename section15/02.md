# Factory Reset and Password Recovery
## Factory Reset

- 라우터나 스위치를 공장 초기화 하는 명령어는 다음과 같다.
	- write erase
		- startup-config를 지우는 명령이다.
		- 이렇게 한 후 장치를 재부팅하면 구성이 빈 채로 부팅될 것이다.
		- startup-config가 없기 때문에 설정 마법사가 실행된다.
## Config Register

- 구성 레지스터는 라우터가 기본으로 부팅되는 방식을 변경하기 위해 사용된다.
- 글로벌 구성 모드에서 config-register 명령을 사용하거나 라우터나 스위치가 완전히 부팅되지 않았을 때 나오는 ROMMON 프롬프트에서 confreg 명령을 사용할 수 있다.
	- 예를들어 글로벌 구성에서 config-register 0x2142 명령을 사용하거나, ROMMON 프롬프트에서 confreg 0x2142 명령을 사용할 수 있다.
		- 0x2102: 기본값으로 장치가 정상적으로 부팅된다.
		- 0x2120: ROMMON 모드로 부팅을 한다.
		- 0x2142: 부팅 중에 NVRAM의 내용(startup-config)을 무시한다.
## Router Password Recovery Procedure

- 활성 프롬프트에 대한 접근을 읽게 되어 비밀번호 복구가 필요한 상황을 보자.(암호를 까먹음)
- 재부팅 중에 키보드에서 정지 키 조합을 누른다. 보통은 **Ctrl-Break 조합**이지만 콘솔에 연결하기 위해 사용하는 소프트웨어에 따라 달라질 수 있다.
	- 장치가 켜지는 최초 단계에서 이 키 조합을 누르면 **ROMMON 프롬프트**가 나올 것이다.
- 부팅 중에 startup-config 파일을 무시하도록 하기 위해서 ROMMON 프롬프트에서 **confreg 0x2142** 명령을 입력한다. 공장 초기화를 할 때처럼 startup-config를 지우는 것은 아니다. startup-config는 그대로 있다.
	- 하지만 라우터는 부팅 중에 startup-config를 사용하지 않을 것이다. 그러니 활성화 암호를 알고있을 필요가 없는 것이다.
- ROMMON 프롬프트에서 **reset**을 입력해 장치를 부팅한다.
- 이러면 라우터는 아무 구성없이 부팅되어 설정마법사로 들어가는데, 이를 우회하기 위해서 **no를 입력**한다.
- 그 다음에 **enable** 명령을 통해 활성화 모드로 들어가게 되는데, 현재 실행 중인 구성에 있는 게 아니기 때문에 활성화 암호를 요구 받는 일은 없을 것이다.
- 다음으로는 **startup-config를 running-config로 복사**해야 한다.
	- 이 단계를 무시한다면 장치를 공장 초기화하게 되고 기존의 구성을 잃게 될 것이다.
	- 이렇게 활성화 암호를 포함한 기존의 모든 구성이 running-config로 복사된다.
- 이제 활성화 모드로 들어갔으니 **글로벌 구성 모드에서 새로운 암호를 입력해 이전 암호를 대체**하면 된다. 그러면 이 변경 사항이 현재 running-config에 포함될 것이다.
- 그 다음 **config-register 0x2102**를 입력하여, 라우터가 다음 재부팅 시 정상적으로 부팅되도록 한다.
	- 이 단계를 무시한다면 부팅할 때마다 항상 구성이 없이 부팅이 될 것이다.
- 마지막으로 **copy run start** 명령을 실행하여 구성을 저장한다.
	- 이제 로그인이 된 상태가 되고, 활성화 암호를 새롭게 변경한 걸 제외하면 모든게 정상이 되어있을 것이다.
## Switch Password Recovery Procedure

- 스위치 비밀번호 복구도 라우터와 비슷하다, 하지만 장치마다 다를 수 있으므로 Google에 검색하여 복구하는 것을 추천한다.
- 라우터 또한 마찬가지이다.
